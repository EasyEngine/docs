---
ID: 133880
post_title: >
  EasyEngine 3.5.6 Fixes ImageMagick
  Remote Code Execution Vulnerability
author: Prabuddha
post_excerpt: >
  EasyEngine security update to fix recent
  ImageMagick vulnerability discovered by
  slack team at https://imagetragick.com/
layout: post
permalink: >
  https://easyengine.io/blog/fix-imagemagick-remote-code-execution-vulnerability/
published: true
post_date: 2016-05-05 16:59:58
---
<em><strong>TL;DR;</strong> Just run <code>ee update</code> as soon as possible on all server running EasyEngine.</em>

<hr />

<img class="alignright wp-image-133885" src="https://easyengine.io/wp-content/uploads/2016/05/imagetragick-logo.png" alt="imagetragick-logo" width="200" height="206" />A serious vulnerability has been discovered in ImageMagick, which is widely popular package used for image processing. EasyEngine installs ImageMagick for all PHP sites.  WordPress uses ImageMagick first, before falling back to GD library.

ImageMagick is currently working on a patch, available in the <a href="https://github.com/ImageMagick/ImageMagick/commit/a852ab519870e7dc31d6b809498c66fe20c90ad1" target="_blank">latest source code on GitHub</a>, but it's incomplete and not yet ready for official release.

You can read more about this at <a href="https://imagetragick.com">ImageTragick</a>.
<h2>Workarounds</h2>
Below are some workarounds.
<h3>#1. Update EasyEngine</h3>
You can update EasyEngine using <code>ee update</code> to latest version <a href="https://github.com/EasyEngine/easyengine/releases/tag/v3.5.6">3.5.6</a>.

This update fixes ImageMagick policy.xml file which one of two recommended way.

Read next point for more details.
<h3>#2. Fix ImageMagick Manually</h3>
You can do one of two things, but if possible do both. <em>(source <a href="https://imagetragick.com/">https://imagetragick.com/</a>)</em>
<ol>
 	<li>
<blockquote>Verify that all image files begin with the expected <a href="https://en.wikipedia.org/wiki/List_of_file_signatures">"magic bytes"</a> corresponding to the image file types you support before sending them to ImageMagick for processing.</blockquote>
</li>
 	<li>
<blockquote>Use a <a href="https://www.imagemagick.org/script/resources.php">policy file</a> to disable the vulnerable ImageMagick coders. The global policy for ImageMagick is usually found in “/etc/ImageMagick”.  The below policy.xml example will disable the coders EPHEMERAL, URL, MVG, and MSL.</blockquote>
</li>
</ol>
The first one is hard to do as it will require application level modification.

The second one is easier to fix. Please edit ImageMagick policy file <code>/etc/ImageMagick/policy.xml</code> add following lines to it:
<pre>&lt;policymap&gt;
  &lt;policy domain="coder" rights="none" pattern="EPHEMERAL" /&gt;
  &lt;policy domain="coder" rights="none" pattern="URL" /&gt;
  &lt;policy domain="coder" rights="none" pattern="HTTPS" /&gt;
  &lt;policy domain="coder" rights="none" pattern="MVG" /&gt;
  &lt;policy domain="coder" rights="none" pattern="MSL" /&gt;
&lt;/policymap&gt;
</pre>
EasyEngine <code>v3.5.6</code> update uses this second method.

Unfortunately, EasyEngine cannot provide patch for first method. It's better you read next point also.
<h3>#3. Remove ImageMagick</h3>
As mentioned earlier, WordPress doesn't depend on ImageMagick and can be safely removed as far as core WordPress image processing is concerned.

So if you do not have any functionality that depends on ImageMagick, you can remove ImageMagick from your server using following command:

<strong>For PHP 5.6 and PHP 7.x, use</strong>
<pre>apt-get remove php-imagick</pre>
<strong>For PHP 5.5 or earlier, use</strong>
<pre>apt-get remove php5-imagick</pre>
<h2>What's Next?</h2>
We hope to release another minor update once ImageMagick team completes fix in core package.

In meantime, you can monitor <a href="https://imagetragick.com/">imagetragick.com</a> for more updates.

<strong>Links:</strong> <a href="https://imagetragick.com/#why">ImageTragick</a> | <a href="https://github.com/EasyEngine/easyengine/releases/tag/v3.5.6">EasyEngine 3.5.6</a>